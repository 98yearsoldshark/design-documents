# 学生端后端系统详细设计

## 1、系统概述

### 1.1、系统简介
学生端后端系统是基于Node.js和Express框架开发的Web服务器，为学生提供API接口，支持用户账号管理、试卷查看、答题提交、成绩查询等功能，同时与教师端系统进行数据交互，为学生提供完整的在线学习和测评体验。

### 1.2、术语表  
| 序号 | 术语或缩略语 | 说明性定义 |
| ---- | ------------ | ---------- |
| 1    | Express      | 基于Node.js的Web应用框架，提供HTTP服务器功能 |
| 2    | JWT          | JSON Web Token，用于用户身份验证的开放标准 |
| 3    | REST API     | 遵循REST架构风格的应用程序接口 |
| 4    | MySQL        | 关系型数据库管理系统 |
| 5    | Middleware   | 中间件，Express框架中处理HTTP请求的函数 |
| 6    | Authentication | 身份验证，确认用户身份的过程 |

### 1.3、系统运行环境 
- **硬件平台**：标准服务器或云服务器
- **操作系统**：Linux、Windows或macOS
- **运行环境**：Node.js 18.x或更高版本
- **数据库系统**：MySQL 8.x
- **网络协议**：HTTP/HTTPS
- **端口**：3001

### 1.4、开发环境 
- **开发语言**：JavaScript (Node.js)
- **Web框架**：Express 4.x
- **数据库驱动**：mysql2 3.x
- **认证库**：jsonwebtoken 9.x, bcrypt 5.x
- **文件处理**：multer 1.4.x
- **版本控制**：Git
- **代码编辑器**：VS Code或其他现代IDE

## 2、数据结构说明

### 2.1、常量
- **配置常量**
  - `JWT_SECRET`：JWT签名密钥，用于生成和验证令牌
  - `PORT`：服务器端口，默认为3001
  - `CORS_ORIGIN`：允许的跨域来源

- **上传常量**
  - `UPLOAD_DIR`：文件上传目录
  - `MAX_FILE_SIZE`：最大文件大小限制

- **数据库常量**
  - `DB_CONFIG`：数据库连接配置

### 2.2、变量
- **全局变量**
  - `app`：Express应用实例
  - `pool`：MySQL连接池

### 2.3、数据结构

#### 数据库表结构
1. **用户表 (users)**
用户表存储学生基本信息，包含主键id、姓名、邮箱(唯一)、加密密码、联系方式(电话、微信)、学校、班级、学号、注册时间和最后登录时间字段。

2. **用户题目表 (动态创建的per-user表)**
为每个用户动态创建的题目表，存储用户答题记录，包含主键id、题目路径、尝试次数、答案内容、正确性状态和答题时间字段。

3. **试卷记录表 (exam_records)**
记录用户完成的试卷信息，包含主键id、用户id外键、试卷id、得分、总分、开始时间、提交时间、是否已批改和批改时间字段。

4. **答案记录表 (answer_records)**
存储用户对每道题的答案，包含主键id、记录id外键、题目id、答案内容、得分、是否正确和反馈信息字段。

5. **班级成员表 (class_members)**
记录用户加入的班级关系，包含主键id、用户id外键、班级id和加入时间字段，对用户id和班级id建立唯一索引。

#### API请求/响应数据结构
1. **用户认证**
登录请求包含邮箱和密码字段。登录响应包含JWT令牌和用户基本信息(ID、姓名、邮箱、学校、班级、学号、角色等)。

2. **答题提交**
答案提交请求包含试卷ID、答案数组(题目ID和内容)及可选的答题时长。答案提交响应包含成功状态、记录ID和消息字段。

3. **成绩记录**
成绩记录响应包含记录ID、试卷ID、试卷标题、得分、总分、开始时间、提交时间、批改时间、状态(已提交、批改中、已批改)，以及可选的答案详情(包含题目ID、内容、得分、正确性和反馈)。

## 3、模块设计  

### 3.1、软件结构  

#### 系统架构图
后端系统主要包含主服务器入口文件(server.js)、配置文件(config.yaml)、API文档配置(swagger.js)、文件上传处理(uploadHandler.js)、中间件文件夹(包含认证、角色授权和注册验证中间件)、路由模块文件夹(包含试题、记录和个人资料路由)以及数据库相关文件夹(包含数据库初始化脚本)。

### 3.2、功能设计说明 
系统采用模块化设计，以Express路由组织功能模块。使用中间件处理认证、授权和错误，提供RESTful API接口。实现与教师端系统的数据交互，确保学生能查看教师创建的试卷、提交答案、接收反馈。系统支持文件上传，允许学生提交图片答案，并提供个人档案管理功能。

### 3.3、用户认证模块

#### 3.3.1、设计图
用户认证模块组织为三个主要部分：认证路由(学生登录、注册、获取个人信息)、中间件(学生身份验证、注册数据验证、注册后处理)和角色管理(学生角色验证、关联教师ID)。

#### 3.3.2、功能描述
用户认证模块负责学生用户的注册、登录和身份验证，确保只有合法用户能访问系统功能。该模块也处理用户角色关联，实现学生账号与教师账号的关联机制。

#### 3.3.3、输入数据
- 注册信息：姓名、邮箱、密码、学校、班级、学号等
- 登录凭据：邮箱、密码
- 身份验证：HTTP请求头中的Bearer令牌

#### 3.3.4、输出数据
- 注册结果：成功/失败状态和消息
- 登录结果：JWT令牌、用户基本信息
- 身份验证结果：成功或未授权错误

#### 3.3.5、数据设计
使用users表存储用户信息（见2.3节）

#### 3.3.6、算法和流程
1. **注册流程**:
   - 验证请求数据完整性和格式
   - 检查邮箱是否已存在
   - 密码加密处理
   - 创建用户记录
   - 创建用户专属题目表
   - 返回结果

2. **登录流程**:
   - 验证请求数据完整性
   - 查询用户记录
   - 验证密码
   - 获取用户角色信息
   - 生成JWT令牌
   - 更新最后登录时间
   - 返回令牌和基本信息

3. **身份验证流程**:
   - 从请求头提取Bearer令牌
   - 验证令牌有效性
   - 解析令牌载荷获取用户ID
   - 查询用户信息
   - 将用户信息附加到请求对象

#### 3.3.7、函数说明
- **handleLogin(req, res)**
  - 功能：处理用户登录
  - 参数：req(请求对象), res(响应对象)
  - 返回：HTTP响应(JSON)

- **handleRegister(req, res)**
  - 功能：处理用户注册
  - 参数：req(请求对象), res(响应对象)
  - 返回：HTTP响应(JSON)

- **authenticateStudent(req, res, next)**
  - 功能：用户身份验证中间件
  - 参数：req(请求对象), res(响应对象), next(下一个中间件)
  - 返回：调用next()或返回错误响应

#### 3.3.8、全局数据结构与该模块的关系
该模块使用users表存储用户信息，生成的JWT令牌在整个系统中用于身份验证。

#### 3.3.9、子模块设计

##### 3.3.9.1、注册与账号创建子模块

###### 设计图
注册与账号创建子模块分为三个部分：数据验证(必填字段验证、邮箱格式验证、密码强度检查)、账号创建(用户记录创建、密码加密存储、个人题目表创建)和注册后处理(班级关联处理、欢迎邮件发送、初始配置设置)。

###### 功能描述
注册与账号创建子模块负责处理新用户注册流程，包括数据验证、账号创建和注册后处理等步骤。该模块确保用户数据的完整性和安全性，并为新用户创建必要的数据结构。

###### 数据设计
使用registerMiddleware验证用户输入数据，对密码进行bcrypt加密处理，为每个用户创建专属的user_questions_{userId}表存储个人题目数据。

###### 算法和流程
- **注册验证流程**：
  - 检查必填字段（姓名、邮箱、密码）
  - 验证邮箱格式和唯一性
  - 检查密码强度和长度
  - 验证学校和班级信息
  - 返回验证结果

###### 函数说明
- **validateRegistration(userData)**：验证注册数据完整性和有效性
- **createUserAccount(userData)**：创建用户账号和相关数据结构
- **setupInitialUserConfig(userId)**：设置用户初始配置

##### 3.3.9.2、身份验证与会话管理子模块

###### 设计图
身份验证与会话管理子模块分为三个部分：令牌管理(JWT生成、验证和刷新)、会话处理(登录会话创建、状态维护、超时处理)和安全机制(并发登录控制、异常登录检测、登录尝试限制)。

###### 功能描述
身份验证与会话管理子模块处理用户登录认证、JWT令牌生成和验证，以及会话状态管理。该模块是系统安全的核心组件，确保只有授权用户能访问受保护资源。

###### 数据设计
使用JWT存储用户ID和角色信息，设置适当的过期时间，通过中间件验证令牌有效性，同时记录登录历史和会话信息。

###### 算法和流程
- **登录认证流程**：
  - 验证用户凭据
  - 生成JWT令牌
  - 更新登录状态
  - 记录登录历史
  - 返回令牌和用户信息

###### 函数说明
- **generateToken(userId, role)**：生成包含用户ID和角色的JWT令牌
- **verifyToken(token)**：验证JWT令牌的有效性和完整性
- **updateLoginStatus(userId)**：更新用户登录状态和历史记录

##### 3.3.9.3、用户配置文件管理子模块

###### 设计图
用户配置文件管理子模块分为三个部分：个人信息管理(信息查询、更新和验证)、密码管理(密码修改、重置和安全问题设置)和隐私设置(个人数据可见性、通知偏好设置、信息共享控制)。

###### 功能描述
用户配置文件管理子模块提供个人信息查询和更新功能，允许用户管理自己的账号信息、修改密码和设置隐私偏好。该模块确保用户对个人数据的控制权和数据安全。

###### 数据设计
扩展users表以支持更丰富的用户配置和隐私设置，使用单独的用户设置表存储用户偏好，确保核心用户表结构清晰简洁。

###### 算法和流程
- **个人信息更新流程**：
  - 验证用户身份
  - 验证更新数据
  - 更新数据库记录
  - 记录变更历史
  - 返回更新结果

###### 函数说明
- **getUserProfile(userId)**：获取用户完整个人信息
- **updateUserProfile(userId, profileData)**：更新用户个人信息
- **changePassword(userId, currentPassword, newPassword)**：修改用户密码

##### 3.3.9.4、班级关联与角色管理子模块

###### 设计图
班级关联与角色管理子模块分为三个部分：班级关联(班级加入、退出和关系查询)、角色管理(角色分配、权限和同步)和教师关联(教师-学生映射、关联请求处理、跨系统权限)。

###### 功能描述
班级关联与角色管理子模块处理学生与班级、教师的关联关系，管理用户角色和权限设置。该模块是实现学生参与班级活动、与教师互动的基础。

###### 数据设计
使用class_members表存储学生-班级关系，维护user_role_mapping表处理角色分配和教师-学生关联，支持复杂的权限结构和跨系统互操作。

###### 算法和流程
- **班级加入流程**：
  - 验证班级码有效性
  - 检查班级成员限制
  - 创建班级成员记录
  - 处理相关权限设置
  - 返回加入结果

###### 函数说明
- **joinClass(userId, classCode)**：学生通过班级码加入班级
- **leaveClass(userId, classId)**：学生退出班级
- **associateWithTeacher(studentId, teacherId)**：关联学生与教师账号

### 3.4、试卷与答题模块

#### 3.4.1、设计图
试卷与答题模块分为三个部分：试卷路由(获取试卷列表、详情和提交答案API)、中间件(学生身份验证)和处理函数(获取试卷列表、获取试卷详情、提交答案处理)。

#### 3.4.2、功能描述
试卷与答题模块允许学生查看可用试卷，获取试卷详情与题目，并提交答案。该模块与教师端系统交互，获取试卷内容并存储学生答案。

#### 3.4.3、输入数据
- 试卷ID：要查看的试卷
- 答案数据：学生对各题目的答案
- 用户ID：当前学生ID (从JWT)

#### 3.4.4、输出数据
- 试卷列表和详情
- 提交结果：成功/失败状态和消息
- 记录ID：成功提交后生成的记录ID

#### 3.4.5、数据设计
使用exam_records和answer_records表（见2.3节）

#### 3.4.6、算法和流程
1. **获取试卷流程**:
   - 验证用户身份
   - 查询用户可用试卷
   - 过滤和排序试卷列表
   - 返回结果

2. **提交答案流程**:
   - 验证用户身份和试卷有效性
   - 验证答案数据格式
   - 创建考试记录
   - 保存各题目答案
   - 如适用，进行自动评分
   - 返回提交结果

#### 3.4.7、函数说明
- **getExams(req, res)**
  - 功能：获取用户可用试卷列表
  - 参数：req(请求对象), res(响应对象)
  - 返回：HTTP响应(JSON试卷列表)

- **getExamById(req, res)**
  - 功能：获取试卷详情和题目
  - 参数：req(请求对象), res(响应对象)
  - 返回：HTTP响应(JSON试卷详情)

- **submitAnswers(req, res)**
  - 功能：提交试卷答案
  - 参数：req(请求对象), res(响应对象)
  - 返回：HTTP响应(JSON提交结果)

#### 3.4.8、全局数据结构与该模块的关系
该模块使用exam_records和answer_records表存储答题记录，关联users表确认用户身份。

#### 3.4.9、子模块设计

##### 3.4.9.1、试卷获取与展示子模块

###### 设计图
试卷获取与展示子模块分为三个部分：试卷列表(列表获取、筛选排序、分页处理)、试卷详情(试卷信息、题目列表、答题限制)和状态管理(试卷状态、倒计时处理、答题进度)。

###### 功能描述
试卷获取与展示子模块负责获取并展示学生可用的试卷列表和详细信息，处理试卷的筛选、排序和分页，同时管理试卷状态和答题进度。

###### 数据设计
从教师端系统获取试卷和题目数据，根据用户ID和班级关系过滤可用试卷，添加状态信息（如未开始、进行中、已完成），支持多维度筛选和排序。

###### 算法和流程
- **试卷列表获取流程**：
  - 获取用户班级信息
  - 查询适用试卷
  - 添加完成状态
  - 应用筛选条件
  - 排序并分页
  - 返回结果集

###### 函数说明
- **getAvailableExams(userId, filters)**：获取用户可用试卷列表
- **getExamDetails(examId, userId)**：获取试卷详细信息和题目
- **checkExamStatus(examId, userId)**：检查试卷状态和答题权限

##### 3.4.9.2、答题进度与保存子模块

###### 设计图
答题进度与保存子模块分为三个部分：答题进度(进度记录、状态同步、断点恢复)、自动保存(定时保存、事件触发保存、本地缓存)和答题状态(答题时长跟踪、题目完成状态、异常处理)。

###### 功能描述
答题进度与保存子模块负责记录和管理学生的答题进度，提供自动保存功能和断点恢复机制，确保答题数据不会因意外情况丢失，增强系统可靠性和用户体验。

###### 数据设计
使用临时答题记录表存储未提交的答案，结合客户端本地存储实现数据冗余保护，记录用户操作时间戳，支持答题进度的精确恢复。

###### 算法和流程
- **自动保存流程**：
  - 监听答题操作
  - 定时触发保存
  - 同步服务器数据
  - 更新本地缓存
  - 确认保存状态

###### 函数说明
- **saveProgress(userId, examId, answers)**：保存答题进度
- **loadProgress(userId, examId)**：加载之前的答题进度
- **trackAnswerTime(userId, examId)**：跟踪答题时长

##### 3.4.9.3、答案提交与评分子模块

###### 设计图
答案提交与评分子模块分为三个部分：答案提交(数据验证、格式转换、提交处理)、自动评分(客观题评分、部分主观题评分、评分规则应用)和提交状态(提交确认、状态更新、结果通知)。

###### 功能描述
答案提交与评分子模块处理学生答案的最终提交、数据验证和自动评分功能。对于客观题（如单选题、多选题、判断题）进行即时评分，对于主观题记录答案等待教师评阅。

###### 数据设计
使用exam_records存储提交记录，answer_records存储具体答案，记录每道题的得分和正确性，支持部分评分和评分反馈。

###### 算法和流程
- **答案提交流程**：
  - 验证答案完整性
  - 检查提交时间限制
  - 创建答题记录
  - 执行自动评分
  - 计算初步得分
  - 返回提交结果

###### 函数说明
- **submitExamAnswers(userId, examId, answers, duration)**：提交试卷答案
- **autoGradeObjectiveQuestions(answers, correctAnswers)**：自动评分客观题
- **calculateInitialScore(answers, totalScore)**：计算初步得分

##### 3.4.9.4、文件上传与处理子模块

###### 设计图
文件上传与处理子模块分为三个部分：文件上传(文件接收、格式验证、存储处理)、图片处理(图片压缩、OCR识别、格式转换)和资源管理(文件关联、资源清理、访问控制)。

###### 功能描述
文件上传与处理子模块负责处理学生提交的图片和文件资源，包括文件的接收、验证、处理和存储。该模块支持图片答案、手写答案的上传和相关处理，增强系统的多媒体处理能力。

###### 数据设计
使用multer处理文件上传，为每个用户创建独立的文件存储目录，记录文件元数据，支持文件与答案的关联存储和访问控制。

###### 算法和流程
- **文件上传流程**：
  - 验证文件类型和大小
  - 生成安全文件名
  - 保存文件到服务器
  - 处理图片（如需要）
  - 记录文件元数据
  - 关联到答案记录

###### 函数说明
- **handleFileUpload(req, res)**：处理文件上传请求
- **processImageAnswer(filePath)**：处理图片格式答案
- **associateFileWithAnswer(fileId, answerId)**：关联文件与答案记录

### 3.5、成绩记录模块

#### 3.5.1、设计图
成绩记录模块分为三个部分：记录路由(获取成绩记录列表和记录详情API)、中间件(学生身份验证)和处理函数(获取成绩记录列表和记录详情)。

#### 3.5.2、功能描述
成绩记录模块允许学生查看自己的答题记录、成绩和教师反馈。该模块提供按条件筛选和分页功能，帮助学生跟踪学习进度。

#### 3.5.3、输入数据
- 筛选条件：时间范围、科目、状态等
- 分页参数：页码、每页记录数
- 用户ID：当前学生ID (从JWT)

#### 3.5.4、输出数据
- 记录列表：包含基本信息的记录摘要
- 记录详情：包含答案和反馈的完整记录

#### 3.5.5、数据设计
使用exam_records和answer_records表（见2.3节）

#### 3.5.6、算法和流程
1. **获取记录列表流程**:
   - 验证用户身份
   - 应用筛选条件
   - 计算分页参数
   - 查询用户记录
   - 返回分页结果

2. **获取记录详情流程**:
   - 验证用户身份和记录所有权
   - 查询记录详情
   - 查询相关答案
   - 关联试卷和题目信息
   - 返回完整记录

#### 3.5.7、函数说明
- **getRecords(req, res)**
  - 功能：获取用户成绩记录列表
  - 参数：req(请求对象), res(响应对象)
  - 返回：HTTP响应(JSON记录列表)

- **getRecordById(req, res)**
  - 功能：获取记录详情
  - 参数：req(请求对象), res(响应对象)
  - 返回：HTTP响应(JSON记录详情)

#### 3.5.8、全局数据结构与该模块的关系
该模块从exam_records和answer_records表读取数据，关联users表确认用户身份和访问权限。

#### 3.5.9、子模块设计

##### 3.5.9.1、成绩统计与分析子模块

###### 设计图
成绩统计与分析子模块分为三个部分：成绩统计(总分统计、平均分计算、分数分布)、学习分析(知识点掌握度、错题分析、进步趋势)和可视化展示(成绩曲线、对比分析、排名情况)。

###### 功能描述
成绩统计与分析子模块提供学生成绩的统计分析功能，帮助学生了解自己的学习情况和成绩趋势。该模块通过多维度的数据分析，为学生提供个性化的学习反馈和建议。

###### 数据设计
从exam_records和answer_records表聚合数据，计算各类统计指标，如平均分、最高分、知识点得分率等，支持时间序列分析和横向对比。

###### 算法和流程
- **成绩统计流程**：
  - 获取用户历史记录
  - 按科目/时间分组
  - 计算统计指标
  - 生成趋势数据
  - 构建分析结果

###### 函数说明
- **calculatePerformanceStats(userId, filters)**：计算用户成绩统计数据
- **analyzeKnowledgePoints(userId, subjectId)**：分析知识点掌握情况
- **generateProgressTrend(userId, timeRange)**：生成学习进步趋势

##### 3.5.9.2、记录查询与筛选子模块

###### 设计图
记录查询与筛选子模块分为三个部分：记录查询(条件查询、全文搜索、高级过滤)、结果处理(分页处理、排序功能、聚合计算)和缓存优化(查询缓存、数据预加载、增量更新)。

###### 功能描述
记录查询与筛选子模块提供灵活的成绩记录查询和筛选功能，支持多种条件组合、排序和分页，帮助学生快速找到需要的记录。该模块优化查询性能，提供良好的用户体验。

###### 数据设计
设计高效的数据库查询语句，合理使用索引，支持复杂的条件组合和排序，实现查询结果的缓存和预加载，减少数据库压力。

###### 算法和流程
- **记录查询流程**：
  - 构建查询条件
  - 应用筛选参数
  - 处理排序要求
  - 执行分页查询
  - 格式化结果集
  - 缓存查询结果

###### 函数说明
- **searchRecords(userId, criteria)**：按条件搜索成绩记录
- **filterRecordsByStatus(records, status)**：按状态筛选记录
- **sortRecordsByField(records, field, order)**：对记录进行排序

##### 3.5.9.3、反馈与批注处理子模块

###### 设计图
反馈与批注处理子模块分为三个部分：批改反馈(教师批注、评分理由、改进建议)、反馈展示(题目反馈、总体评语、批注高亮)和学习建议(错题分析、知识点推荐、学习资源链接)。

###### 功能描述
反馈与批注处理子模块管理教师对学生答案的批注和反馈，并以直观的方式展示给学生。该模块帮助学生理解错误原因，获取学习建议，促进持续改进。

###### 数据设计
扩展answer_records表以存储详细的批注信息，包括批注位置、内容、类型等，支持富文本格式的反馈和可交互的批注展示。

###### 算法和流程
- **反馈处理流程**：
  - 获取答案记录
  - 读取批注数据
  - 按题目组织反馈
  - 处理富文本内容
  - 生成学习建议
  - 构建展示数据

###### 函数说明
- **getAnswerFeedback(answerId)**：获取答案的详细反馈
- **processTeacherAnnotations(annotations)**：处理教师批注
- **generateLearningRecommendations(feedback)**：生成学习建议

##### 3.5.9.4、错题集与复习管理子模块

###### 设计图
错题集与复习管理子模块分为三个部分：错题收集(自动收集、手动标记、分类整理)、复习计划(智能排期、复习提醒、进度跟踪)和练习生成(错题练习、相似题推荐、知识点巩固)。

###### 功能描述
错题集与复习管理子模块自动收集学生答错的题目，提供分类整理和有计划的复习功能。该模块根据学生的错题情况，生成个性化的复习计划和练习，帮助学生巩固知识点。

###### 数据设计
创建错题集表关联用户和题目，记录错误原因、重要程度和复习状态，支持智能复习排期和相似题推荐算法。

###### 算法和流程
- **错题收集流程**：
  - 分析答题记录
  - 提取错误题目
  - 确定错误类型
  - 归类并存储
  - 更新复习计划

###### 函数说明
- **collectWrongQuestions(recordId)**：从答题记录收集错题
- **createReviewPlan(userId, wrongQuestions)**：创建个性化复习计划
- **generateSimilarExercises(questionId)**：生成相似题目练习

## 4、接口设计

### 4.1、用户接口
服务器不直接提供用户界面，而是通过RESTful API与前端交互。

### 4.2、外部接口
系统提供RESTful API，使用HTTP/HTTPS协议与前端通信：

1. **认证接口**
   - `POST /login`: 用户登录
   - `POST /register`: 用户注册
   - `GET /profile`: 获取个人信息
   - `PUT /profile`: 更新个人信息

2. **试卷接口**
   - `GET /exams`: 获取试卷列表
   - `GET /exams/:id`: 获取试卷详情
   - `POST /exams/:id/submit`: 提交答案

3. **记录接口**
   - `GET /records`: 获取答题记录列表
   - `GET /records/:id`: 获取记录详情

4. **班级接口**
   - `GET /classes`: 获取加入的班级列表
   - `POST /classes/join`: 加入班级
   - `GET /classes/:id`: 获取班级详情

5. **文件上传接口**
   - `POST /upload`: 上传文件

### 4.3、内部接口

#### 4.3.1、接口说明
模块间通过函数调用进行交互，主要包括：
- 中间件验证请求有效性并传递给路由处理函数
- 数据库操作函数提供数据访问能力
- 工具函数提供通用功能

#### 4.3.2、调用方式
路由处理示例：定义records路由处理函数，使用authenticateStudent中间件验证身份，从请求查询参数获取页码、数量限制、科目和状态，从JWT提取用户ID构建查询条件，计算分页参数，执行数据库查询获取总数和分页数据，最后返回包含记录列表、总数、当前页码、页面大小和总页数的JSON响应。出错时返回500错误及错误信息。

## 5、数据库设计 
系统使用MySQL关系型数据库，表结构详见2.3节。主要数据表关系如下：

- users表：存储学生用户信息
- user_questions_{userId}表：针对每个用户创建的专属题目表
- exam_records表：存储用户答题记录，关联users表
- answer_records表：存储详细答案，关联exam_records表
- class_members表：存储班级成员关系，关联users表

## 6、系统出错处理 

### 6.1、出错信息
| 错误类型 | 错误代码 | 错误信息 | 处理方式 |
| -------- | -------- | -------- | -------- |
| 认证错误 | 401 | "未授权：无效的令牌" | 返回401状态码和错误信息 |
| 权限错误 | 403 | "禁止：无权访问此资源" | 返回403状态码和错误信息 |
| 资源不存在 | 404 | "未找到：请求的资源不存在" | 返回404状态码和错误信息 |
| 请求无效 | 400 | "请求无效：[具体原因]" | 返回400状态码和详细错误说明 |
| 服务器错误 | 500 | "服务器内部错误" | 记录错误日志，返回500状态码 |
| 数据库错误 | 500 | "数据库操作失败" | 记录错误日志，返回500状态码 |

### 6.2、补救措施
- **全局错误处理**：使用try-catch块和Express错误处理中间件捕获异常
- **数据校验**：使用验证中间件确保输入数据有效
- **事务处理**：多步数据操作使用事务确保一致性
- **错误日志**：记录详细错误信息便于排查
- **优雅降级**：核心功能出错时提供备用响应
- **自动重试**：特定操作失败时自动重试

## 7、其他设计

### 7.1、安全设计
- **JWT认证**：使用JWT进行用户身份验证
- **密码加密**：使用bcrypt加密存储用户密码
- **输入验证**：验证和清理所有请求数据
- **参数绑定**：使用参数化查询防止SQL注入
- **防跨站请求伪造**：实现CSRF保护机制
- **文件上传安全**：验证文件类型和大小，使用安全的存储路径

### 7.2、性能设计
- **数据库连接池**：使用MySQL连接池优化连接管理
- **查询优化**：优化SQL查询，使用适当的索引
- **数据分页**：大数据集使用分页返回，减少响应大小
- **内存管理**：避免大对象长时间占用内存
- **并发处理**：利用Node.js异步特性处理并发请求 